# ゴルフクラブヘッド軌道追跡システム 要件定義 v0.2 (AIPC / OpenVINO / FastAPI)

- **起案日**: 2025-10-08  
- **想定プラットフォーム**: AIPC（単ユーザー）  
- **実行基盤**: OpenVINO Runtime（CPU/GPU/NPU）  
- **提供形態**: FastAPI ベースのローカルWebアプリ（ブラウザから操作・結果閲覧）

---

## 1. 目的 / ゴール
- **目的**: ゴルフクラブヘッドの軌道を録画動画から解析し、  
  軌道を可視化、速度を推定してスイング解析に活用する。  

- **成果指標**
  - 速度推定誤差: ≤ ±5%  
  - 処理スループット: GPU/NPU時 60fps 以上、CPU時 30fps 以上  
  - 軌道追跡継続率: ≥ 98%

---

## 2. スコープ
- **対象**: 録画済み動画ファイル（mp4/mov/avi 等）のオフライン解析  
- **オプション**: ライブカメラ入力（優先度低、将来拡張）  
- **非対象**: クラウド連携、マルチユーザー同時解析、自動コーチング機能

---

## 3. ステークホルダー
- ユーザー: 個人ゴルファー、コーチ  
- 運用・保守: 開発チーム（社内）

---

## 4. 想定ユースケース
1. 動画をアップロード  
2. キャリブレーション（クラブ長/基準物体）  
3. バッチ解析実行  
4. 結果動画（軌道オーバーレイ付き）と速度統計を生成  
5. CSV/JSON で保存、ブラウザで閲覧

---

## 5. 機能要件 (MoSCoW)

### Must
- YOLOv8(OpenVINO) によるクラブヘッド検出  
- CPU/GPU/NPU 切替実行  
- 追跡（Kalman + IOU/ByteTrack相当）  
- 軌道オーバーレイ付き動画生成  
- 速度推定（m/s）  
- バッチ処理 & 再開  
- CLI + FastAPI Web UI 提供  

### Should
- 動画入力（mp4/mov/avi、H.264/H.265）  
- キャリブレーション保存  
- 軌道/速度平滑化  
- Web UI でジョブ進捗・結果表示  
- 並列化（動画ごと）

### Could
- ライブカメラ入力（低優先）  
- 3D化（PnP, 床平面利用）  
- インパクト検出、自動レポート出力

### Won’t
- クラウド連携、SNS共有、音声コーチング

---

## 6. 非機能要件
- **性能**: 1080p動画で実時間以上の処理  
- **可用性**: 長尺動画や多数バッチでも安定  
- **セキュリティ**: ローカル処理、外部送信なし  
- **移植性**: Windows 11 AIPC 優先、将来 Linux 対応検討  
- **観測性**: ジョブログ、エラー・推論時間・fpsを記録  

---

## 7. 外部連携 / インターフェース
- **ランタイム**: OpenVINO Runtime  
- **入出力**:
  - 入力: HTTPアップロードされた動画ファイル  
  - 出力: MP4結果動画、CSV、JSON、スナップショットPNG  
- **設定**: YAML/JSON  
- **FastAPI エンドポイント例**:
  - `POST /api/jobs` 動画アップロード & 解析開始  
  - `GET /api/jobs/{id}` ジョブ状態取得  
  - `WS /ws/jobs/{id}` 進捗通知  
  - `GET /api/jobs/{id}/results` 解析結果取得  

---

## 8. アーキテクチャ
- **サーバ構成**: FastAPI (ASGI) + ワーカー + OpenVINO推論 + ローカルFS  
- **フロントエンド**: HTML/JS, Canvas軌道描画  
- **パイプライン**:  
  Decode → YOLOv8(OpenVINO) → Tracker → Smoothing → Metrics → Overlay → Export  
- **ジョブ管理**: QUEUED / RUNNING / SUCCEEDED / FAILED  

---

## 9. 品質保証
- 単体: 推論、追跡、速度計算、CSV整合  
- 結合: ファイルI/O、並列ジョブ  
- API: スキーマ検証 (pydantic)  
- ベンチ: 各デバイス性能検証  

---

## 10. マイルストーン
- M0: 要件凍結  
- M1: オフラインPoC（動画精度検証）  
- M2: バッチ処理 & CLI 完成  
- M3: FastAPI & Web UI 実装  
- M4: GPU/NPU最適化、βリリース  

---

## 11. 受け入れ基準
- GPU/NPUで 60fps 以上処理、CPUで 30fps 以上  
- 速度誤差 ±5% 以内  
- 軌道追跡の途切れ ≤ 2フレーム/スイング  
- ブラウザで「アップロード→進捗表示→結果閲覧」が可能  

---

## 12. オープン事項
- 認証方式（ローカルのみ / トークン）  
- 最大アップロードサイズ & 保存期間  
- UI: 素朴なHTML/JSか、Reactベースで拡張するか  
